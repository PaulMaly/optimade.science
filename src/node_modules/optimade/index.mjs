import 'isomorphic-unfetch';

const baseURL = 'https://cors.optimade.science';
const providersURL = `https://providers.optimade.science/providers.json`;
const providersCorsURL = `${baseURL}/${providersURL.replace('://', '/')}`;

async function getJSON(uri, params = null, headers = {}) {
    const url = new URL(uri);
    if (params) {
        Object.entries(params).forEach((param) => url.searchParams.append(...param));
    }
    const res = await fetch(url.toString(), { headers });
    if (!res.ok) {
        const err = new Error(res.statusText);
        err.response = res;
        throw err;
    }
    if (res.status !== 204) {
        return await res.json();
    }
}
async function getProviders() {
    return getJSON(providersCorsURL);
}

export { getJSON, getProviders };
