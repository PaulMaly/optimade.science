import 'isomorphic-unfetch';

import type { ResponseError, ProvidersResponse } from './types';

import { providersCorsURL } from '../optimade.config.js';

export async function getJSON(uri: string, params: {} = null, headers: {} = {}) {

    const url = new URL(uri);

    if (params) {
        Object.entries(params).forEach((param: [string, any]) => url.searchParams.append(...param));
    }

    const res = await fetch(url.toString(), { headers });

    if (!res.ok) {
        const err: ResponseError = new Error(res.statusText);
        err.response = res;
        throw err;
    }

    if (res.status !== 204) {
        return await res.json();
    }
}

export async function getProviders(): Promise<ProvidersResponse> {
    return getJSON(providersCorsURL);
}